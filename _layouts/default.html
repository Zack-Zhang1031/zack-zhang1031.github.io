<!DOCTYPE html>
<html lang="{{ site.lang | default: "en-US" }}">
<head>
  <meta charset="UTF-8">
  {% seo %}
  <!-- MathJax for LaTeX -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']]
      }
    };
  </script>
  <script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <!-- 样式与字体 -->
  <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#157878">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  {% include head-custom.html %}

  <!-- 自定义增强样式 -->
  <style>
    /* 导航栏样式 */
    .navbar {
      background: var(--navbar-bg, #222);
      padding: 10px 0;
      display: flex;
      justify-content: center;
      gap: 2rem;
      font-size: 1.1rem;
      color: #fff;
    }
    .navbar a { color: inherit; text-decoration: none; padding: 0 10px;}
    .navbar a.active, .navbar a:hover { color: #ffd700; }

    /* 暗黑模式样式 */
    body.dark-mode {
      background: #181b1f !important;
      color: #c9d1d9 !important;
    }
    body.dark-mode .navbar { background: #161a1e; }
    body.dark-mode .toc { background: #23262b; }
    body.dark-mode .page-header { background: #23262b; }
    body.dark-mode code, body.dark-mode pre { background: #222 !important; color: #ffd700; }

    /* 目录（TOC）样式 */
    .toc {
      background: #f9f9f9;
      padding: 1em 1.5em;
      border-radius: 12px;
      font-size: 0.97rem;
      margin: 1.5em 0 1.5em 0;
      max-width: 350px;
      box-shadow: 0 2px 8px rgba(0,0,0,.05);
      position: relative;
    }
    body.dark-mode .toc { background: #20232a; }

    /* 回到顶部按钮样式 */
    #backToTop {
      display: none;
      position: fixed;
      right: 28px;
      bottom: 40px;
      background: #222;
      color: #fff;
      border: none;
      outline: none;
      border-radius: 30px;
      width: 46px;
      height: 46px;
      font-size: 23px;
      cursor: pointer;
      box-shadow: 0 4px 24px #0004;
      z-index: 1001;
      opacity: 0.8;
      transition: background .2s, opacity .2s;
    }
    #backToTop:hover { background: #ffd700; color: #222; opacity: 1;}
    /* 搜索框样式 */
    .search-container {
      display: inline-block;
      margin-left: 30px;
    }
    .search-input {
      padding: 4px 10px;
      border-radius: 5px;
      border: 1px solid #bbb;
      font-size: 1rem;
      width: 120px;
      transition: width 0.2s;
    }
    .search-input:focus { width: 200px; }
    body.dark-mode .search-input { background: #222; color: #ffd700; border: 1px solid #666;}
    /* 暗黑模式切换按钮 */
    #dark-toggle {
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 1.5em;
      font-size: 1.3rem;
      color: inherit;
    }
  </style>
</head>
<body>
  <!-- 全站导航栏 -->
  <nav class="navbar">
    <a href="/" {% if page.url == "/" %}class="active"{% endif %}><i class="fa fa-home"></i> 首页</a>
    <a href="/categories/" {% if page.url contains 'categories' %}class="active"{% endif %}>分类</a>
    <a href="/tags/" {% if page.url contains 'tags' %}class="active"{% endif %}>标签</a>
    <a href="/about/" {% if page.url contains 'about' %}class="active"{% endif %}>关于</a>
    <span class="search-container">
      <input class="search-input" id="search-input" type="text" placeholder="搜索..." />
    </span>
    <button id="dark-toggle" title="切换暗黑模式"><i class="fa fa-moon"></i></button>
  </nav>

  <a id="skip-to-content" href="#content">Skip to the content.</a>

  <header class="page-header" role="banner">
    <h1 class="project-name">{{ page.title | default: site.title | default: site.github.repository_name }}</h1>
    <h2 class="project-tagline">{{ page.description | default: site.description | default: site.github.project_tagline }}</h2>
    {% if site.github.is_project_page %}
      <a href="{{ site.github.repository_url }}" class="btn">View on GitHub</a>
    {% endif %}
    {% if site.show_downloads %}
      <a href="{{ site.github.zip_url }}" class="btn">Download .zip</a>
      <a href="{{ site.github.tar_url }}" class="btn">Download .tar.gz</a>
    {% endif %}
  </header>

  <main id="content" class="main-content" role="main">
    <!-- 自动 TOC 目录（用JS动态生成，插入文档第一个 h2 之前） -->
    <div class="toc" id="toc"></div>
    {{ content }}

    <footer class="site-footer">
      {% if site.github.is_project_page %}
        <span class="site-footer-owner"><a href="{{ site.github.repository_url }}">{{ site.github.repository_name }}</a> is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a>.</span>
      {% endif %}
      <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a>.</span>
    </footer>
  </main>
  <!-- 回到顶部按钮 -->
  <button id="backToTop" title="回到顶部"><i class="fa fa-arrow-up"></i></button>

  <!-- 功能脚本 -->
  <script>
    // 暗黑模式切换
    const darkBtn = document.getElementById('dark-toggle');
    darkBtn.onclick = function() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('dark-mode', document.body.classList.contains('dark-mode'));
      this.innerHTML = document.body.classList.contains('dark-mode')
        ? '<i class="fa fa-sun"></i>' : '<i class="fa fa-moon"></i>';
    };
    // 页面加载时自动同步暗黑状态
    if (localStorage.getItem('dark-mode') === 'true') {
      document.body.classList.add('dark-mode');
      darkBtn.innerHTML = '<i class="fa fa-sun"></i>';
    }

    // 回到顶部按钮
    const backToTop = document.getElementById('backToTop');
    window.onscroll = function() {
      backToTop.style.display = (document.documentElement.scrollTop || document.body.scrollTop) > 240 ? 'block' : 'none';
    };
    backToTop.onclick = function() {
      window.scrollTo({top: 0, behavior: 'smooth'});
    };

    // 自动 TOC（目录生成，提取 h2/h3/h4）
    function createTOC() {
      let content = document.querySelector('#content');
      if (!content) return;
      let headings = content.querySelectorAll('h2, h3, h4');
      if (headings.length === 0) { document.getElementById('toc').style.display='none'; return;}
      let tocHtml = '<strong>目录</strong><ul style="margin-top:0.8em">';
      headings.forEach(h => {
        if (!h.id) h.id = h.textContent.trim().replace(/\s+/g, '-');
        tocHtml += `<li style="margin-left:${(parseInt(h.tagName[1])-2)*18}px">
          <a href="#${h.id}">${h.innerText}</a></li>`;
      });
      tocHtml += '</ul>';
      document.getElementById('toc').innerHTML = tocHtml;
    }
    window.addEventListener('DOMContentLoaded', createTOC);

    // 简单站内搜索（仅支持当前页面内容关键词高亮）
    document.getElementById('search-input').oninput = function() {
      let val = this.value.trim();
      let main = document.querySelector('.main-content');
      // 清理旧高亮
      main.innerHTML = main.innerHTML.replace(/<mark>(.*?)<\/mark>/g, '$1');
      if (val.length === 0) return;
      // 简单关键词高亮（不会改变链接、代码块等结构，适合小页面预览）
      main.innerHTML = main.innerHTML.replace(new RegExp(val, 'gi'), function(m) {
        return '<mark style="background: #fff3a3; color: #222;">'+m+'</mark>';
      });
    };
  </script>
</body>
</html>
